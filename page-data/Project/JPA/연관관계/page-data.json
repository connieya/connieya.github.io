{"componentChunkName":"component---src-templates-post-template-tsx","path":"/Project/JPA/연관관계/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%84%A4%EC%A0%95\">의존성 설정</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B8%B0%EB%8A%A5\">기능</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%84%A4%EA%B3%84%ED%95%98%EA%B8%B0\">데이터베이스 테이블 설계하기</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\">연관관계 설정하기</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A0%9C%EC%95%BD-%EC%A1%B0%EA%B1%B4-%EC%84%A4%EC%A0%95\">제약 조건 설정</a></p>\n<ul>\n<li><a href=\"#%ED%8C%94%EB%A1%9C%EC%9A%B0\">팔로우</a></li>\n<li><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94\">좋아요</a></li>\n</ul>\n</li>\n</ul>","html":"<p>인스타그램의 주요 기능을 개발하기 위해 JPA를 사용하여 객체를 데이터베이스 테이블에 매핑하고, 이들 사이의 연관관계를 설정했습니다.</p>\n<h3 id=\"의존성-설정\" style=\"position:relative;\"><a href=\"#%EC%9D%98%EC%A1%B4%EC%84%B1-%EC%84%A4%EC%A0%95\" aria-label=\"의존성 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>의존성 설정</h3>\n<p>JPA 의존성 설정</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.springframework.boot<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>spring-boot-starter-data-jpa<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3 id=\"기능\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%8A%A5\" aria-label=\"기능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기능</h3>\n<p>구현해야 할 기능</p>\n<ul>\n<li>팔로우/팔로우 취소</li>\n<li>좋아요 / 좋아요 취소</li>\n<li>게시물 (피드) 등록</li>\n<li>게시물에 댓글 달기</li>\n</ul>\n<h3 id=\"데이터베이스-테이블-설계하기\" style=\"position:relative;\"><a href=\"#%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%ED%85%8C%EC%9D%B4%EB%B8%94-%EC%84%A4%EA%B3%84%ED%95%98%EA%B8%B0\" aria-label=\"데이터베이스 테이블 설계하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>데이터베이스 테이블 설계하기</h3>\n<p>필요한 데이터베이스 테이블을 생각해보자</p>\n<ol>\n<li>회원 정보를 저장하는 user 테이블</li>\n<li>팔로우 관계를 저장하는 follow 테이블</li>\n<li>게시물 좋아요 정보를 저장하는 likes 테이블</li>\n<li>게시물 (피드) 정보를 저장하는 image 테이블</li>\n<li>댓글 정보를 저장하는 comment 테이블</li>\n</ol>\n<p>기능에 필요한 테이블을 정리 했으니 이제 JPA 를 사용해서\n앤티티와 테이블을 매핑해보자</p>\n<ul>\n<li>user 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ....</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>follow 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Follow</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// ....</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>likes 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Likes</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>images 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Image</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ul>\n<li>comment 엔티티</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Comment</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>위와 같이 엔티티를 생성하고\napplication.yml 에서</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"> <span class=\"token key atrule\">jpa</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">hibernate</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">ddl-auto</span><span class=\"token punctuation\">:</span> create</code></pre></div>\n<p>jpa ddl 설정을 create 로 한 뒤</p>\n<p>애플리케이션을 실행하면 데이터베이스 테이블이 자동으로 생성된다.</p>\n<p>create 외에 jpa 스키마 생성 속성은 다음과 같다.</p>\n<ul>\n<li>create : 기존 테이블 삭제 후 다시 생성 (DROP + CREATE)</li>\n<li>create-drop : create 와 같으나 종료시점에 테이블 drop</li>\n<li>update : 변경분만 반영</li>\n<li>validate : 엔티티와 테이블이 정상 매핑되었는지만 확인</li>\n<li>none : 사용하지 않음</li>\n</ul>\n<h3 id=\"연관관계-설정하기\" style=\"position:relative;\"><a href=\"#%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84-%EC%84%A4%EC%A0%95%ED%95%98%EA%B8%B0\" aria-label=\"연관관계 설정하기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>연관관계 설정하기</h3>\n<p>연관관계를 설정하기 위해서 도메인 모델을 분석해보자.</p>\n<p><strong>게시물 등록</strong></p>\n<ul>\n<li>회원은 게시물을 등록할 수 있다.</li>\n<li>게시물(images) 과 회원(user) 의 관계 : 회원은 여러 게시물(피드)을 등록할 수 있다.</li>\n<li>게시물 N : 회원 1</li>\n</ul>\n<p>회원 엔티티 : 1</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> nickname<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Image</span><span class=\"token punctuation\">></span></span> images<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>게시물 (피드) 엔티티  : N</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Image</span> <span class=\"token punctuation\">{</span> <span class=\"token comment\">// N : 1</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> caption<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> postImageUrl<span class=\"token punctuation\">;</span> \n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>외래 키로 조인을 사용해서 연관된 테이블을 찾는 방식</p>\n<p>즉,\n관계형 데이터베이스의 테이블에 맞춰서 모델링을 한 것이 아니라\n객체를 참조해서 연관된 객체를 찾는 방식이기 때문에</p>\n<p>JPA 에게 객체 관의 관계를 알려줘야 한다.</p>\n<p>참조하는 객체 위에 @OneToMany , @ManyToOne 애노테이션을 설정 해야 한다.</p>\n<ul>\n<li>@ManyToOne :  게시물이 N 이고 회원이 1이기 때문에  Image 엔티티에서 참조하는 User 객체에 설정</li>\n<li>@OneToMany : 회원이 1이고 게시물이 N이기 때문에 User 엔티티에서 참조하는 Image 객체에 설정\n<ul>\n<li>mapppedBy : 양방향 연관관계에서 사용한다.</li>\n<li>테이블은 외래 키 하나로 두 테이블의 연관관계를 정리</li>\n<li>하지만 객체는 양방향으로 참조해야 한다. (단방향 연관 관계가 두 개 있음)</li>\n<li>회원 엔티티에서 게시물로의 단방향 참조 (회원 -> 게시물), 게시물 엔티티에서 회원으로의 단방향 참조 (게시물 -> 회원</li>\n<li>양방향 참조 시, 어느 쪽이 외래 키를 가지고 있어야 할까?</li>\n<li>N 쪽이 갖고 있어야 한다.</li>\n<li>외래 키를 관리 (등록 및 수정)하는 연관 관계의 주인은 어느 쪽을 지정해야 할까?</li>\n<li>외래 키를 갖고 있는 N 쪽이 주인이다. 즉, 게시물 엔티티가 주인이다.</li>\n<li>주인은 mappedBy 속성을 사용하지 않고, 주인이 아닌 회원 엔티티가 mappedBy 속성으로 주인을 지정해야 한다.</li>\n<li>주인이 아닌 쪽은 읽기만 가능하다.</li>\n</ul>\n</li>\n<li>@JoinColumn : 테이블의 컬럼 명을 지정할 수 있다.</li>\n</ul>\n<p><strong>팔로우/팔로우 취소하기</strong></p>\n<ul>\n<li>회원은 다른 회원을 팔로우 할 수 있다.</li>\n<li>팔로우(follow) 와 회원(user) 의 관계 : 회원을 여러 회원을 팔로우 할 수 있다.</li>\n<li>팔로우 N : 회원 1</li>\n</ul>\n<p>회원 엔티티</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> username<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> nickname<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Image</span><span class=\"token punctuation\">></span></span> images<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>팔로우 엔티티</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Follow</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fromUserId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> fromUser<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"toUserId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> toUser<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<p>팔로우 하는 사람과 팔로우를 받는 사람에 대한 필드를 섫정 했다.</p>\n<p><strong>좋아요/좋아요 취소</strong></p>\n<ul>\n<li>게시물에 ‘좋아요’ 를 클릭할 수 있다.</li>\n<li>게시물(image) 과 좋아요(likes) 의 관계 : 하나의 게시물에는 여러 개의 좋아요를 받을 수 있다.</li>\n<li>좋아요 N : 게시물 1</li>\n<li>회원(user) 과 좋아요(likes)의 관계 : 회원은 여러 개의 게시물에 좋아요를 누를 수 있다.</li>\n<li>좋아요 N : 회원 1</li>\n</ul>\n<p>게시물 엔티티</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Image</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> caption<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> postImageUrl<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"image\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 연관관계의 주인이 아니다.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Likes</span><span class=\"token punctuation\">></span></span> likes<span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>좋아요 엔티티</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Likes</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"imageId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Image</span> image<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>어떤 게시물에 누가 좋아요를 눌렀는 지 알아야 하기 때문에</p>\n<p>Image 엔티티와 User 엔티티가 필요하다.</p>\n<p><strong>댓글 달기</strong></p>\n<ul>\n<li>게시물(피드) 에 댓글을 작성할 수 있다.</li>\n<li>게시물(image) 과 댓글(comment) 의 관계 : 하나의 게시물에는 여러 개의 댓글이 작성 될 수 있다.</li>\n<li>댓글 N : 게시물 1</li>\n<li>회원은 댓글을 작성할 수 있다.</li>\n<li>회원(user) 과 댓글(comment) 의 관계 : 회원은 댓글을 여러 번 작성 할 수 있다.</li>\n<li>댓글 N : 회원 1</li>\n</ul>\n<p>댓글 엔티티</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Comment</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> content<span class=\"token punctuation\">;</span>\n\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Image</span> image<span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>어떤 게시물에 누가 댓글을 작성 했는지 알아야 하기 때문에</p>\n<p>user 엔티티와 image 엔티티가 필요하다.</p>\n<p>게시물 엔티티</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Image</span> <span class=\"token punctuation\">{</span> \n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> caption<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> postImageUrl<span class=\"token punctuation\">;</span> \n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"image\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 연관관계의 주인이 아니다.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Likes</span><span class=\"token punctuation\">></span></span> likes<span class=\"token punctuation\">;</span>\n    \n\n    <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"image\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 연관관계의 주인이 아니다.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Comment</span><span class=\"token punctuation\">></span></span> comments <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3 id=\"제약-조건-설정\" style=\"position:relative;\"><a href=\"#%EC%A0%9C%EC%95%BD-%EC%A1%B0%EA%B1%B4-%EC%84%A4%EC%A0%95\" aria-label=\"제약 조건 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>제약 조건 설정</h3>\n<p>기능을 구현 할 때 필요한 제약 조건을 설정하자</p>\n<h4 id=\"팔로우\" style=\"position:relative;\"><a href=\"#%ED%8C%94%EB%A1%9C%EC%9A%B0\" aria-label=\"팔로우 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>팔로우</h4>\n<p>팔로우 기능은 중복 되면 안된다.</p>\n<p>A 라는 유저가 B 라는 유저를 팔로우 하는 것은 1번만 해야 한다.</p>\n<p>DB follow 테이블에 fromUserId , toUserId 값이 중복 되면 안되게 unique 제약 조건을 설정 해보자</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>\n        uniqueConstraints <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@UniqueConstraint</span><span class=\"token punctuation\">(</span>\n                        name <span class=\"token operator\">=</span> <span class=\"token string\">\"subscribe_uk\"</span><span class=\"token punctuation\">,</span>\n                        columnNames <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"fromUserId\"</span> <span class=\"token punctuation\">,</span><span class=\"token string\">\"toUserId\"</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Follow</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"fromUserId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JsonIgnore</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> fromUser<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"toUserId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAZY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@JsonIgnore</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> toUser<span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>@Table 애노테이션에 uniqueConstraints 속성으로  DDL 생성 시에 유니크 제약 조건을 생성 할 수 있다.</p>\n<h4 id=\"좋아요\" style=\"position:relative;\"><a href=\"#%EC%A2%8B%EC%95%84%EC%9A%94\" aria-label=\"좋아요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>좋아요</h4>\n<p>좋아요 기능은 중복 되면 안된다.</p>\n<p>회원은 1개의 게시물에 좋아요를 1번만 할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>\n        uniqueConstraints <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token annotation punctuation\">@UniqueConstraint</span><span class=\"token punctuation\">(</span>\n                        name <span class=\"token operator\">=</span> <span class=\"token string\">\"likes_uk\"</span><span class=\"token punctuation\">,</span>\n                        columnNames <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"imageId\"</span> <span class=\"token punctuation\">,</span><span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">}</span>\n                <span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Likes</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">int</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"imageId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Image</span> image<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"userId\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@ManyToOne</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n    \n<span class=\"token punctuation\">}</span></code></pre></div>","frontmatter":{"title":"JPA를 활용한 데이터베이스 구축: 연관 관계","summary":"JPA를 활용하여 객체와 데이터베이스 테이블을 매핑하고, 이들 간의 연관관계를 설정했습니다.","date":"2023.03.11.","categories":["Project","JPA"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB0klEQVR42q2S0W+aUBTG/f/3sJdua9JkL2sWNdnDmlZdTKC21UqqUpVShFqpKEiRgiBWEPx2uWxsfdvDvuTkJufk/HLu+U4BvxQnMZxgCcs3sN56NLffZ7U7PcBp38bZwAb36P1uged5EAQB7XYboigiCAIU0kKURHi0R7h/7pMYQCKx8OY58EpZ4QOj49O5jpPbJc1tNhvUajXouo4wDKGqKur1egY0PA3igsdw1oMwz16JwP2tT5tb4xWOLhf43DRRGWTAF8fBl+NjKIpCYZIkoVgsZsAnR0F/eoNq8wTX9xf4cX2KyUrEw3yBpzHQfPDx/kzEu289VAQHmGlwZBlfS2Xc8jxYlgVP3nK5nAE1d4I7gwcnXaE34XAjNzFaDmCvX/IJD9kpDhkVlaGdTWhZdEKO49DtdtFqtVAqlTJgEHqQTLI7a0i+OqS7nNgyNSrVhezigNXx8dzAd96iuWi3Q7VaQ6PRQKfToVMyDJMBU61DH/OViqk7JobMsIuj3E3l+RXsyEGDgPvaOs+nZqSmpPszDANRFP0Bptq+buF7PpIkwb9oR6Y0TRO2bcN1Xdr3BugQ5zRNQxiFbxrT8/k78tuNY+pyeoup03tSLOA/6yelN+WlF3WUMgAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/d71b764072a74872fdf6a6b3ecedec51/61664/img.png","srcSet":"/static/d71b764072a74872fdf6a6b3ecedec51/e2022/img.png 78w,\n/static/d71b764072a74872fdf6a6b3ecedec51/35a4c/img.png 155w,\n/static/d71b764072a74872fdf6a6b3ecedec51/61664/img.png 310w","sizes":"(min-width: 310px) 310px, 100vw"},"sources":[{"srcSet":"/static/d71b764072a74872fdf6a6b3ecedec51/e20da/img.webp 78w,\n/static/d71b764072a74872fdf6a6b3ecedec51/c55ba/img.webp 155w,\n/static/d71b764072a74872fdf6a6b3ecedec51/65587/img.webp 310w","type":"image/webp","sizes":"(min-width: 310px) 310px, 100vw"}]},"width":310,"height":152.00000000000003}},"publicURL":"/static/d71b764072a74872fdf6a6b3ecedec51/img.png"}}}}]}},"pageContext":{"slug":"/Project/JPA/연관관계/"}},"staticQueryHashes":[],"slicesMap":{}}