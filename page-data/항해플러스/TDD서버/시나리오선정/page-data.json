{"componentChunkName":"component---src-templates-post-template-tsx","path":"/항해플러스/TDD서버/시나리오선정/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EC%84%A0%EC%A0%95\">시나리오 선정</a></p>\n<ul>\n<li>\n<p><a href=\"#e-%EC%BB%A4%EB%A8%B8%EC%8A%A4-%EC%84%9C%EB%B9%84%EC%8A%A4\">e-커머스 서비스</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD\">요구사항</a></p>\n<ul>\n<li>\n<p><a href=\"#%EC%A3%BC%EC%9A%94-api\">주요 API</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B0%9C%EB%B0%9C-%ED%99%98%EA%B2%BD\">개발 환경</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%84%A4%EA%B3%84\">엔티티 설계</a></p>\n<ul>\n<li><a href=\"#%EC%9E%AC%EA%B3%A0-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%A7%80-%EC%95%8A%EC%9D%80-%EC%9D%B4%EC%9C%A0\">재고 엔티티를 만들지 않은 이유</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#tdd-test-driven-development\">TDD (Test Driven Development)</a></p>\n</li>\n<li>\n<p><a href=\"#%EA%B5%AC%ED%98%84\">구현</a></p>\n<ul>\n<li>\n<p><a href=\"#%EB%A0%88%EB%93%9C---%EA%B7%B8%EB%A6%B0---%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\">레드 - 그린 - 리팩토링</a></p>\n</li>\n<li>\n<p><a href=\"#%EC%A3%BC%EB%AC%B8-%ED%85%8C%EC%8A%A4%ED%8A%B8\">주문 테스트</a></p>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-1-%EC%83%81%EC%84%B8%ED%95%9C-%EA%B5%AC%ED%98%84-%EB%A1%9C%EC%A7%81\">문제 1. 상세한 구현 로직</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%95%B4%EA%B2%B0-1-%EC%B1%85%EC%9E%84%EC%9D%84-%EB%B6%84%EB%A6%AC\">해결 1. 책임을 분리</a></p>\n<ul>\n<li><a href=\"#%EC%9C%A0%EC%A0%80-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\">유저 가져오기</a></li>\n<li><a href=\"#%EC%A3%BC%EB%AC%B8\">주문</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%AC%B8%EC%A0%9C-2-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EA%B8%B0-%ED%9E%98%EB%93%A0-%EC%BD%94%EB%93%9C\">문제 2. 테스트 하기 힘든 코드</a></p>\n</li>\n<li>\n<p><a href=\"#%ED%95%B4%EA%B2%B0-2-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%B6%84%EB%A6%AC\">해결 2 관심사 분리</a></p>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%8B%A8%EC%9C%84%ED%85%8C%EC%8A%A4%ED%8A%B8-vs-%EC%9C%A0%EB%8B%9B%ED%85%8C%EC%8A%A4%ED%8A%B8\">단위테스트 vs 유닛테스트</a></p>\n<ul>\n<li>\n<p><a href=\"#%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8\">유닛 테스트</a></p>\n<ul>\n<li><a href=\"#first-%EC%9B%90%EC%B9%99\">F.I.R.S.T 원칙</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EC%9E%94%EC%95%A1-%EC%B0%A8%EA%B0%90-%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8\">잔액 차감 단위 테스트</a></p>\n<ul>\n<li><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C\">테스트 코드</a></li>\n<li><a href=\"#test-double\">Test Double</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%86%B5%ED%95%A9-%ED%85%8C%EC%8A%A4%ED%8A%B8\">통합 테스트</a></p>\n<ul>\n<li>\n<ul>\n<li><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-1\">테스트 코드</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\">느낀점</a></p>\n</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>","html":"<h1 id=\"시나리오-선정\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EB%82%98%EB%A6%AC%EC%98%A4-%EC%84%A0%EC%A0%95\" aria-label=\"시나리오 선정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시나리오 선정</h1>\n<h2 id=\"e-커머스-서비스\" style=\"position:relative;\"><a href=\"#e-%EC%BB%A4%EB%A8%B8%EC%8A%A4-%EC%84%9C%EB%B9%84%EC%8A%A4\" aria-label=\"e 커머스 서비스 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>e-커머스 서비스</h2>\n<p>e-커머스 상품 주문 서비스를 TDD 기반으로 구현</p>\n<h2 id=\"요구사항\" style=\"position:relative;\"><a href=\"#%EC%9A%94%EA%B5%AC%EC%82%AC%ED%95%AD\" aria-label=\"요구사항 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>요구사항</h2>\n<ul>\n<li>상품 주문에 필요한 메뉴 정보들을 구성하고 조회가 가능해야 한다.</li>\n<li>사용자는 상품을 여러 개 선택해 주문할 수 있고, 미리 충전된 잔액을 이용한다.</li>\n<li>상품 주문 내역을 통해 판매량이 가장 높은 상품을 추천합니다.</li>\n</ul>\n<h3 id=\"주요-api\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EC%9A%94-api\" aria-label=\"주요 api permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주요 API</h3>\n<ul>\n<li>잔액 충전 / 조회 API</li>\n<li>상품 조회 API</li>\n<li>주문 / 결제 API</li>\n<li>인기 판매 상품 조회 API</li>\n</ul>\n<h3 id=\"개발-환경\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%B0%9C-%ED%99%98%EA%B2%BD\" aria-label=\"개발 환경 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개발 환경</h3>\n<ul>\n<li>spring data jpa</li>\n<li>h2 database</li>\n<li>lombok</li>\n<li>junit 5 , mockito</li>\n</ul>\n<h3 id=\"엔티티-설계\" style=\"position:relative;\"><a href=\"#%EC%97%94%ED%8B%B0%ED%8B%B0-%EC%84%A4%EA%B3%84\" aria-label=\"엔티티 설계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>엔티티 설계</h3>\n<p>요구 사항에 필요한 최소한의 엔티티만 설계</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ea80c0d1f35c3eb2fcd5e138cac734d/a7dde/img.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.60416666666667%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAACrklEQVR42n1U6XKiQBj0PXLIISoeIB4IggJy451spWp3a9//MXp7JppYW9n86IIZZnq+r7uHlqJ2cI/RyCYsTGdzzOYu5oTjzDAe27CsCTpGD21F/1h//y7QEhMCz22NEzqSOEaa5TgcjjieztjtD6h3eyTbFNs0gzkY4elZxf2+27tA6+MkQiX2RYq3n7/x9usPji8/EGcFsrJGSdKi2cMcjq+H/6fC+4GmGZixveVyBXfhYeUFCFwPzpTtSyzQ65ryYLFW+47Q4AJD70LjAp0taayiQxgcqxyLp5gTJDrX6qoh92j/eCAJ1Suh7UwRriPkRYMk2cLzfdniIwmH5ogaVsjzUmqcF6WsWlW0rwl1It5sUFYN1kmKDQmzooJlT/HwpGBsDnEQ5lDTiN9z6upSDrX9DWG6DnB5ecXueEFR75HXu0/C/gDnpkLDb+EmQioJ/a8JlSvhaumywhphnMEPNojiFEPmUrbcM5EnMbZ5BS+IsI4SaZIqTKFcX5rSFh+oiWaMoHeH0PQ+1E4fWsekuwM+CYPz3TFjZrwbqNyc1j+DLarTZEgZWFaj6Ob7qcp7aHXhtAgwD1D0noyMOZ6j1xtgSCkMoy9lE2iJjLkLl46u2GKGNfVxPeZw6cG2HXTZ6nQyw4T5nMx99EgwmTiodifUDHrd7OTe9q3lLEmkm9E2Q8q4ZIxDFG+R5gWWfiAPK5sDCrpfVtSPc95ijhOvZEiNU8YoYNRuAW/VaYLT5RVrkgRRTCQII3EIXeTmOPCl88LxnKQh1y2cCV7OJxZQI0lzrO4Jk3WIZn9CnBayypg/gEj8CFjhnLGwxxaCcIMVsaQUFlt3Z1O8Xs4yQllZMUYx9b4SqrxuqrhCAuLq3UHMP9GMh8e2xCPzKCLU5X0W2jszV+Z0MLQ+KvwLNo/yOtqoCJwAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/4ea80c0d1f35c3eb2fcd5e138cac734d/a59e9/img.webp 192w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/0ca9f/img.webp 384w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/dc9b9/img.webp 768w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/e2c2f/img.webp 1152w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/f3efb/img.webp 1536w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/0fd57/img.webp 1564w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/4ea80c0d1f35c3eb2fcd5e138cac734d/3b721/img.png 192w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/66595/img.png 384w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/fe486/img.png 768w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/d2d74/img.png 1152w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/e8464/img.png 1536w,\n/static/4ea80c0d1f35c3eb2fcd5e138cac734d/a7dde/img.png 1564w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/4ea80c0d1f35c3eb2fcd5e138cac734d/fe486/img.png\"\n            alt=\"img.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<ul>\n<li>User 엔티티 : 사용자 식별 ID , 이름, 잔액 (포인트)</li>\n<li>Product 엔티티 : 상품 고유 ID , 상품 이름, 상품 가격 , 상품 재고</li>\n<li>Order 엔티티 : 주문 고유 Id , 주문 한 상품 총 가격</li>\n<li>OrderProduct 엔티티\n<ul>\n<li>주문한 상품에 대한 내역 엔티티</li>\n<li>주문 Id , 상품 Id, 주문한 상품 개수, 주문 당시 상품 가격</li>\n</ul>\n</li>\n<li>Point 엔티티 : 잔액(포인트) 고유 Id, 포인트 내역 (충전 , 차감) , 금액</li>\n</ul>\n<h4 id=\"재고-엔티티를-만들지-않은-이유\" style=\"position:relative;\"><a href=\"#%EC%9E%AC%EA%B3%A0-%EC%97%94%ED%8B%B0%ED%8B%B0%EB%A5%BC-%EB%A7%8C%EB%93%A4%EC%A7%80-%EC%95%8A%EC%9D%80-%EC%9D%B4%EC%9C%A0\" aria-label=\"재고 엔티티를 만들지 않은 이유 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>재고 엔티티를 만들지 않은 이유</h4>\n<p>재고 Entity 를 따로 만들지 않고 Product 에서 재고 상태를 필드로 관리 하였다.\r\n그 이유는 지금은 TDD 를 중점 으로 공부 하는 것이기 때문에 코드가 심플한 것이 좋다</p>\n<p>재고를 Entity 로 관리 하면 비즈니스 로직 복잡도가 올라 가고\r\n테스트도 복잡해지기 때문에 재도 Entity 를 만들지 않았다.</p>\n<h2 id=\"tdd-test-driven-development\" style=\"position:relative;\"><a href=\"#tdd-test-driven-development\" aria-label=\"tdd test driven development permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TDD (Test Driven Development)</h2>\n<blockquote>\n<p>프로덕션 코드보다 테스트 코드를 먼저 작성하여 테스트가 구현 과정을 주도하도록\r\n하는 방법론</p>\n</blockquote>\n<h2 id=\"구현\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84\" aria-label=\"구현 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현</h2>\n<h3 id=\"레드---그린---리팩토링\" style=\"position:relative;\"><a href=\"#%EB%A0%88%EB%93%9C---%EA%B7%B8%EB%A6%B0---%EB%A6%AC%ED%8C%A9%ED%86%A0%EB%A7%81\" aria-label=\"레드   그린   리팩토링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레드 - 그린 - 리팩토링</h3>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 443px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/39350612b57150d8b8584a738ccf163a/4d697/img_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 86.45833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2klEQVR42pVUbUhTYRQeplAoZFODCn9oBvrDxB/RD4lMSLLAipVhVqBBiVJNKWoL6UOiTMMwhSwLYRAr98NGuLI0/GjN+W0fwrLN4SrRNjenTu/uvU/v3rupCz/qwrnvPfc95znPec7LK8IKD89x1Pz+sSx58cvmiJZHE5Jmh80YlkphSNuPkaIiML/H/fb/DdAbzIyNYSA2DlqRCLrAQLoOpuwBzzDLgi4JyLvddB2trIKOgPSKxeiPjkZPcDA6iG/TNCy0/z+AluJiCtgfE4MvEgl6IyOpP65U+sWtDuit7GhvRwdpVU9AOgMCKLvuiAi4TCYh8K+BrTgU33StNTXoCQ9DV1AQ+ghDm1otBCzR7spTJo+i5SOaDEbAPgGHXg92ahrWlgZMD31dfSg82XSTqgzRxfPtdLmQUfYQz9t03u4ExvbOVliqS8A4HWA5t9dYf0CeJgjVWG/i48YW3K3XzIP5dOWYORjvyTGhe+8nDcdz/gw97F7re3BLUYf6dh0MP0dhIy0KwSxhzVHjCBve6cSkfRzqTiUevSlD13ctIcVTZiKfDIVVT7Am5TDWpR6FKPkQsksqCJCwyS+ShU7f5UDOg3TE5gcj/nwotl/YgNrmigWG2s+DCDt4EjFZuYjKPIPYU3kISTsGVauWBg1Y9LDYTPhlH6H+07f3EZcfgn03EqjtkkUT2wqL1SwA1mqakHTuMk6XVkJy7Q4yi0uRLJWh/IXniLCQvczB7cZClDfJwXAu3FQWYMfFTZArclH0LA/51RnYeWkL9N9aBcBPRjPE6VkIPXAcmyXZCE8/gbV7j+Bddz9l9GPCjBlmCrPuGeqrPtTSdpOuRFF2iYUbkXo9HtbJMY+Ggi7lKjXCSdseDdcTYHmNYok7w3sDMS7IFGeRWBCBBKkYu69uw6uuukXHxhvYN2SEsrkNHYMG4fjwPiDOO5qFgzznnoXe0AZNtwqmUcN8wT/PrYqh2lupCwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/39350612b57150d8b8584a738ccf163a/a59e9/img_1.webp 192w,\n/static/39350612b57150d8b8584a738ccf163a/0ca9f/img_1.webp 384w,\n/static/39350612b57150d8b8584a738ccf163a/0adf7/img_1.webp 443w\"\n              sizes=\"(max-width: 443px) 100vw, 443px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/39350612b57150d8b8584a738ccf163a/3b721/img_1.png 192w,\n/static/39350612b57150d8b8584a738ccf163a/66595/img_1.png 384w,\n/static/39350612b57150d8b8584a738ccf163a/4d697/img_1.png 443w\"\n            sizes=\"(max-width: 443px) 100vw, 443px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/39350612b57150d8b8584a738ccf163a/4d697/img_1.png\"\n            alt=\"img_1.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>이미지 출처 <a href=\"https://mbauza.medium.com/red-green-refactor-1a3fb160e649\" target=\"_blank\" rel=\"nofollow\">https://mbauza.medium.com/red-green-refactor-1a3fb160e649</a></p>\n<ol>\n<li>TDD는 프로덕션 코드 없이 테스트를 먼저 작성 하는 방법 이기 때문에 실패를 한다. (레드)</li>\n<li>빠른 시간 내에 최소한의 코드로 구현부를 작성 하여 테스트를 통과한다. (그린)</li>\n<li>테스트 통과를 유지하면서 구현 된 코드를 개선 한다. (리팩토링)</li>\n</ol>\n<h3 id=\"주문-테스트\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EB%AC%B8-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"주문 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주문 테스트</h3>\n<ul>\n<li>사용자 식별자와 상품 ID, 수량 목록을 입력 받아 주문한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">  <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"사용자 식별자와 상품 ID, 수량 목록을 받아 주문을 수행한다.\"</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token annotation punctuation\">@Test</span>\r\n    <span class=\"token keyword\">void</span> <span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// given</span>\r\n\r\n        <span class=\"token comment\">// when</span>\r\n\r\n\r\n        <span class=\"token comment\">//then</span>\r\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>주문에 대한 테스트를 작성하기 전에 어떤 기능을 만들어야 하는지 생각 해보자</p>\n<ul>\n<li>사용자 식별 Id , 상품 목록 (상품 식별 Id , 수량) 을 받는다.</li>\n<li>각 상품에 재고가 있는지 확인 후 차감한다.</li>\n<li>재고 차감 후 주문 한 상품들의 총 가격을 구한다.</li>\n<li>사용자의 현재 잔액 과 총 가격을 비교 한 뒤 잔액이 부족하면 예외 처리, 그렇지 않으면 잔액을 차감한다.</li>\n<li>주문을 생성하고, 결제를 진행한다.</li>\n</ul>\n<p>테스트 코드를 먼저 작성해야 하는데,</p>\n<p>어떻게 작성해야 할지 감이 오지 않아</p>\n<p>테스트 메소드만 만들고 바로 구현에 들어갔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ProductRepository</span> productRepository<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">OrderRepository</span> orderRepository<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PointService</span> pointService<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 주문 전에 재고 차감</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderPostRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> productRequest <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> productIdQuntitiyMap <span class=\"token operator\">=</span> productRequest<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// product id 추출</span>\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span>productRequest<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n         <span class=\"token comment\">// 재고 차감</span>\r\n        <span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">,</span> stockMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n        <span class=\"token comment\">// 주문</span>\r\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        orderRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// 결제</span>\r\n        pointService<span class=\"token punctuation\">.</span><span class=\"token function\">processPayment</span><span class=\"token punctuation\">(</span>savedOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> productIdQuntitiyMap<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span> product <span class=\"token operator\">:</span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">Long</span> quantity <span class=\"token operator\">=</span> productIdQuntitiyMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">isLessThanQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InsufficientStockException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INSUFFICIENT_STOCK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            product<span class=\"token punctuation\">.</span><span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>주문 객체에서</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\">   <span class=\"token annotation punctuation\">@Builder</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>user <span class=\"token operator\">=</span> user<span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>product <span class=\"token operator\">=</span> <span class=\"token function\">getOrderProducts</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>totalPrice <span class=\"token operator\">=</span> <span class=\"token function\">calculateTotalPrice</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getOrderProducts</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n               <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>product <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">OrderProduct</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> product<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">long</span> <span class=\"token function\">calculateTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">mapToLong</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span><span class=\"token operator\">::</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">sum</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n     <span class=\"token keyword\">public</span> <span class=\"token keyword\">static</span> <span class=\"token class-name\">Order</span> <span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>해당 상품을 주문했을 때 총 가격과 OrdurProduct 엔티티 (주문 과 상품 엔티티를 연결해주는 엔티티) 에 주문한 상품에 대한 정보를 저장한다.</p>\n<ul>\n<li>OrderPostRequest 에는 사용자의 식별 ID 와 상품 식별 Id 와 재고의 목록을 담고 있는 List Dto 객체가 있다.</li>\n<li>주문을 하기 전 각 상품의 재고를 확인 하기 위해서 List Dto 객체에서 상품 아이디 리스트를 추출한다.</li>\n<li>해당 상품 아이디에 해당하는 재고를 알기 위해 List Dto 안에 있는 상품 id 와 상품 재고를 key ,value 형태의 Map 을 추출한다.</li>\n<li>이때 key 는 상품 식별 Id, value 는 해당 상품에 대한 재고 수량이다.</li>\n<li>상품 id 리스트와 재고 수량 Map 을 통해 재고를 차감하는 메서드를 실행한다. 이때 재고 보다 주문 수량이 많으면 예외를 발생시킨다.</li>\n<li>재고 차감 이후 사용자 정보와 상품 id 리스트로 주문을 생성한다.</li>\n<li>주문이 성공하면 해당 주문에 대한 결제를 수행한다.</li>\n</ul>\n<p>이렇게 주문에 대한 메소드를 작성했다.</p>\n<p>하지만 위의 코드에는 여러가지 문제점이 있었다.</p>\n<h3 id=\"문제-1-상세한-구현-로직\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-1-%EC%83%81%EC%84%B8%ED%95%9C-%EA%B5%AC%ED%98%84-%EB%A1%9C%EC%A7%81\" aria-label=\"문제 1 상세한 구현 로직 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 1. 상세한 구현 로직</h3>\n<p>위의 메소드는 주문을 생성하는 메소드이다.\r\n하지만 메소드는 주문을 생성하는 것 외에도 많은 것을 하고 있다.</p>\n<p>유저를 가져와서 사용자 검증을 하고 , 재고 차감을 위해서 DTO에서\r\n상품 목록과 재고 수량 map 을 만든 뒤에… 재고를 차감..\r\n등등…</p>\n<p>비즈니스 로직보다는 상세한 구현 로직에 가깝다.</p>\n<p>위의 코드를 다른 사람이 보면 빠르고 명확하게 해석하기 힘들 것 같다.</p>\n<p>올바른 비즈니스 로직은 상세 구현 로직을 잘 모르더라도 비즈니스의 흐름은 이해 가능한 로직이어야 한다.</p>\n<h3 id=\"해결-1-책임을-분리\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-1-%EC%B1%85%EC%9E%84%EC%9D%84-%EB%B6%84%EB%A6%AC\" aria-label=\"해결 1 책임을 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 1. 책임을 분리</h3>\n<p>책임을 분리한다. 즉 클래스를 분리하자</p>\n<p>OrderService 에서 주문을 하는 행위에만 집중할 수 있게\r\n각 역할을 갖는 클래스를 생성하여 협력할 수 있게 만들자.</p>\n<h4 id=\"유저-가져오기\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EC%A0%80-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0\" aria-label=\"유저 가져오기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유저 가져오기</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">UserReader</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">User</span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> userid<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>userid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>  <span class=\"token operator\">-></span><span class=\"token keyword\">new</span> <span class=\"token class-name\">EntityNotFoundException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">USER_NOT_FOUND</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>UserReader read 메서드를 통해 목적이 더욱 뚜렷해졌다.</p>\n<p>또한 OrderService 에서는 UserRepository 에 의존하지 않기 때문에</p>\n<p>유지 보수하기 편해진다. (Spring Data JPA 에서 다른 것으로 변경하려고 할 때 의존성이 강하게 되면 변경해야 할 코드가 많아진다.)</p>\n<h4 id=\"주문\" style=\"position:relative;\"><a href=\"#%EC%A3%BC%EB%AC%B8\" aria-label=\"주문 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>주문</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderAppender</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">OrderRepository</span> orderRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Order</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">return</span> orderRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>마찬가지로 OrderAppender 라는 클래스를 통해 목적이 뚜렷한 클래스를 만들었고 비즈니스 서비스 계층과 레포지토리 계층 사이에\r\n하나의 계층을 두어 강한 결합의 의존성을 완화시켰다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PointManager</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PointRepository</span> pointRepository<span class=\"token punctuation\">;</span>\r\n\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Long</span> totalPrice <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> totalPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InsufficientPointsException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INSUFFICIENT_POINT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        <span class=\"token class-name\">Point</span> point <span class=\"token operator\">=</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> totalPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        pointRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>위의 코드 역시 PointService 에서 수행한 구현 로직을\r\nPointManager 클래스로 옮겨 목표를 뚜렷하게 하였다.</p>\n<p>재고 차감과 관련된 로직은 문제가 한 개 더 있기 때문에</p>\n<p>밑에서 이어서 설명 하겠다.</p>\n<h3 id=\"문제-2-테스트-하기-힘든-코드\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C-2-%ED%85%8C%EC%8A%A4%ED%8A%B8-%ED%95%98%EA%B8%B0-%ED%9E%98%EB%93%A0-%EC%BD%94%EB%93%9C\" aria-label=\"문제 2 테스트 하기 힘든 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제 2. 테스트 하기 힘든 코드</h3>\n<p>주문이 잘 되는지 테스트를 위해서는 주문 뿐만 아니라 주문과 관련된 모든 로직에 대한 테스트가 필요하다.</p>\n<p>그렇기 때문에 재고 차감에 대한 테스트도 있어야 한다.</p>\n<p>문제는</p>\n<p>재고 차감과 관련된 메소드는\r\nOrderSerivce 안에 private 메서드로 되어 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">private</span> <span class=\"token keyword\">static</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> stockMap<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span> product <span class=\"token operator\">:</span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">Long</span> quantity <span class=\"token operator\">=</span> stockMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">isLessThanQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InsufficientStockException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INSUFFICIENT_STOCK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            product<span class=\"token punctuation\">.</span><span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span></code></pre></div>\n<p>그럼 어떻게 테스트 할 것인가???</p>\n<p>이때 관심사를 분리해야 한다.</p>\n<p>이 부분은 문제 1. 해결 1과 같은 맥락으로 이해하면 된다.</p>\n<p>사실 재고 차감에 대한 테스트를 어떻게 해야 할까 고민을 하는 순간에\r\n문제 1번이 보이기 시작했고, 문제 1번에 대한 해결책이\r\n문제 2번에 대한 해결책으로 이어졌다.</p>\n<h3 id=\"해결-2-관심사-분리\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0-2-%EA%B4%80%EC%8B%AC%EC%82%AC-%EB%B6%84%EB%A6%AC\" aria-label=\"해결 2 관심사 분리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결 2 관심사 분리</h3>\n<p>OrderService 에서 재고를 조회하고 차감을 하는 행위까지 하고 있다.</p>\n<p>재고 차감이라는 메서드는 어디서든 재사용 될 수 있는 행위이고\r\n재고 차감 뿐 아니라 재고 증가라는 행위도 있기 때문에\r\n재고 조회와 차감은 재고와 관련된 객체로 독립적으로 분리되어야 한다.</p>\n<p>StockManager 라는 객체를 생성하여 관심사를 분리하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StockManager</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ProductRepository</span> productRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderPostRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// key : productId , value : quantity</span>\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> productRequest <span class=\"token operator\">=</span> request<span class=\"token punctuation\">.</span><span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> productIdQuntitiyMap <span class=\"token operator\">=</span> <span class=\"token function\">convertToProductIdQuantityMap</span><span class=\"token punctuation\">(</span>productRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// product id 추출</span>\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> <span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span>productRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">,</span>stockMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">convertToProductIdQuantityMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> productRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span>productRequest<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> productIdQuntitiyMap<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span> product <span class=\"token operator\">:</span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">Long</span> quantity <span class=\"token operator\">=</span> productIdQuntitiyMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">isLessThanQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InsufficientStockException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INSUFFICIENT_STOCK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            product<span class=\"token punctuation\">.</span><span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>StockManager 로 관심사를 분리했지만</p>\n<p>여전히 문제가 남아있었다.</p>\n<p>아직까지 deductQuantity 메서드는 private 작성되어 있다.</p>\n<p>그 이유는</p>\n<p>StockManager 에 재고 차감 행위 외에도 상품 고유 id를 가져오는 행위 , 상품 id와 재고 수량을 매핑하는 행위가 있기 때문이다.</p>\n<p>상품 목록을 가져오는 것은 아래 코드에서 볼 수 있듯이\r\n주문을 위해 사용하고 재사용 될 여지가 많기 때문에</p>\n<p>관심사를 분리해야 할 것 같다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">Order</span> savedOrder <span class=\"token operator\">=</span> orderAppender<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>따라서 상품 목록을 행위는\r\n재고 클래스가 아닌 상품 클래스에서\r\n하는 것이 맞는 것 같다.</p>\n<p>ProductReader 클래스를 생성한 뒤 상품 목록을\r\n가져오는 행위를 수행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductReader</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ProductRepository</span> productRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> productRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span>productRequest<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그리고 ProductReader 클래스에서 상품 id 와 재고 수량을 매핑하는\r\n행위 까지 추가 하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductReader</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ProductRepository</span> productRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">read</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> productRequest<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span>productRequest<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">convertToProductIdQuantityMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">return</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">stream</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">collect</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Collectors</span><span class=\"token punctuation\">.</span><span class=\"token function\">toMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getProductId</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token operator\">::</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>이제 StockManager 는 재고을 차감하는 행위만 하면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">StockManager</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token punctuation\">,</span>  <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> productIdQuntitiyMap<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Product</span> product <span class=\"token operator\">:</span> products<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n            <span class=\"token class-name\">Long</span> quantity <span class=\"token operator\">=</span> productIdQuntitiyMap<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">.</span><span class=\"token function\">isLessThanQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n                <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InsufficientStockException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INSUFFICIENT_STOCK</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n            <span class=\"token punctuation\">}</span>\r\n            product<span class=\"token punctuation\">.</span><span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span>quantity<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>재고를 차감하는 행위와 상품 목록을 가져오는 행위는\r\n분리되었고 다른 클래스에서도 재사용할 수 있게 되었다.</p>\n<p>내가 작성한 기능들을 테스트하기 위해 ,</p>\n<p>테스트 하기 좋은 코드로 변경하였고</p>\n<p>테스트 하기 좋은 코드를 생각하다 보니 현재 비즈니스 로직의 문제점이\r\n보이기 시작하였고,</p>\n<p>아래와 같이 비즈니스 로직 코드를 전체 수정하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderService</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserReader</span> userReader<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ProductReader</span> productReader<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">OrderAppender</span> orderAppender<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PointManager</span> pointManager<span class=\"token punctuation\">;</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">StockManager</span> stockManager<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 주문 전에 재고 차감</span>\r\n    <span class=\"token annotation punctuation\">@Transactional</span>\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderPostRequest</span> request<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> userReader<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getUserId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// 상품 목록 가져 오기</span>\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> productReader<span class=\"token punctuation\">.</span><span class=\"token function\">read</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n       <span class=\"token comment\">// key : 상품 id , value : 주문 수량</span>\r\n        <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Long</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span><span class=\"token punctuation\">></span></span> productIdQuntitiyMap <span class=\"token operator\">=</span> productReader<span class=\"token punctuation\">.</span><span class=\"token function\">convertToProductIdQuantityMap</span><span class=\"token punctuation\">(</span>request<span class=\"token punctuation\">.</span><span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// 재고 차감</span>\r\n        stockManager<span class=\"token punctuation\">.</span><span class=\"token function\">deduct</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">,</span>stockMap<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">// 주문</span>\r\n        <span class=\"token class-name\">Order</span> savedOrder <span class=\"token operator\">=</span> orderAppender<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// 결제</span>\r\n        pointManager<span class=\"token punctuation\">.</span><span class=\"token function\">process</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>savedOrder<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>이제 각 기능 단위로 테스트를 시작할 수 있게 되었다.</p>\n<p>테스트에는 여러 종류가 있는데, 위에서 언급 한대로 기능 단위로\r\n테스트 하는 것은 유닛 테스트이다.</p>\n<p>테스트에는 유닛 테스트 외에 통합 테스트도 존재한다.</p>\n<p>주문을 하는 행위에 대해서 단위 테스트와 유닛 테스트 모두 작성 해보자</p>\n<h2 id=\"단위테스트-vs-유닛테스트\" style=\"position:relative;\"><a href=\"#%EB%8B%A8%EC%9C%84%ED%85%8C%EC%8A%A4%ED%8A%B8-vs-%EC%9C%A0%EB%8B%9B%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"단위테스트 vs 유닛테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>단위테스트 vs 유닛테스트</h2>\n<h3 id=\"유닛-테스트\" style=\"position:relative;\"><a href=\"#%EC%9C%A0%EB%8B%9B-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"유닛 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>유닛 테스트</h3>\n<ul>\n<li>하나의 모듈을 기준으로 독립적으로 진행되는 가장 작은 단위의 테스트이다.</li>\n<li>=> 내가 작성한 함수, 혹은 코드가 정상적으로 의도한 대로 동작하는 기 검증</li>\n</ul>\n<h4 id=\"first-원칙\" style=\"position:relative;\"><a href=\"#first-%EC%9B%90%EC%B9%99\" aria-label=\"first 원칙 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>F.I.R.S.T 원칙</h4>\n<ul>\n<li>Fast : 테스트 코드의 실행은 빠르게 진행되어야 한다.</li>\n<li>Independent : 독립적인 테스트가 가능해야 한다.</li>\n<li>Repeatable : 테스트는 매번 같은 결과를 만들어야 한다.</li>\n<li>Self-Validating : 테스트는 그 자체로 실행하여 결과를 확인할 수 있어야 한다.</li>\n<li>Timely : 단위 테스트는 비즈니스 코드가 완성되기 전에 구성하고 테스트가 가능해야 한다.\n<ul>\n<li>=> 코드가 완성되기 전부터 테스트가 따라와야 한다는 TDD 원칙을 담고 있다.</li>\n</ul>\n</li>\n</ul>\n<p>나는 여기서 5번째 Timely 는 지키지 못했다. 테스트 코드를 작성하기 전 비즈니스 코드가 이미 완성되었다…</p>\n<p>앞으로 TDD를 하기 위해서는 요구 사항을 기능 단위로 쪼갠 다음, 테스트 코드를 작성해야 겠다. 테스트 하기 좋은 코드를 생각하다 보면\r\n클린 코드는 따라오게 되어 있을 것이다.</p>\n<h3 id=\"잔액-차감-단위-테스트\" style=\"position:relative;\"><a href=\"#%EC%9E%94%EC%95%A1-%EC%B0%A8%EA%B0%90-%EB%8B%A8%EC%9C%84-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"잔액 차감 단위 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>잔액 차감 단위 테스트</h3>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PointManager</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PointRepository</span> pointRepository<span class=\"token punctuation\">;</span>\r\n\r\n\r\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">process</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">User</span> user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Order</span> order<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token class-name\">Long</span> totalPrice <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&lt;</span> totalPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n            <span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">InsufficientPointsException</span><span class=\"token punctuation\">(</span><span class=\"token constant\">INSUFFICIENT_POINT</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token punctuation\">}</span>\r\n        user<span class=\"token punctuation\">.</span><span class=\"token function\">deductPoints</span><span class=\"token punctuation\">(</span>totalPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token class-name\">Point</span> point <span class=\"token operator\">=</span> <span class=\"token class-name\">Point</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> totalPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        pointRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>point<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token punctuation\">}</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>잔액 차감에 대한 단위 테스트를 진행 하려고 보니</p>\n<p>잔액 차감은 user 가 하는 행위인데 PointManager에서 진행하고 있다는 것이\r\n보이기 시작했다.</p>\n<p>잔액 차감이라는 행위 역시 재사용을 충분히 할 수 있는데, PointManager 클래스 안에\r\n숨겨져 있다.</p>\n<p>관심사를 분리해야 할 것 같다.</p>\n<p>UserManager 클래스를 만들어서 잔액을 차감하는 역할을 위임하자</p>\n<p>UserManager 클래스에서 잔액 차감 뿐만 아니라 잔액 충전도 할 수 있을 것 같다.</p>\n<p>이렇게 기능 단위로 관심사를 분리하니 유닛 테스트 하기 수월해졌다.</p>\n<h4 id=\"테스트-코드\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C\" aria-label=\"테스트 코드 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 코드</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ExtendWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">MockitoExtension</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\r\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserManagerTest</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token annotation punctuation\">@InjectMocks</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserManager</span> userManager<span class=\"token punctuation\">;</span>\r\n\r\n\r\n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"주문 한 상품 들의 총 가격 만큼 잔액을 차감한다.\"</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token annotation punctuation\">@Test</span>\r\n    <span class=\"token keyword\">void</span> <span class=\"token function\">deductPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// given</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"건희\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> product1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"양파\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> product2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"당근\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product1<span class=\"token punctuation\">,</span> product2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// when</span>\r\n        userManager<span class=\"token punctuation\">.</span><span class=\"token function\">deductPoint</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Long</span> totalPrice <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">//then</span>\r\n        <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrentPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">20000L</span><span class=\"token operator\">-</span>totalPrice<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n\r\n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"주문 한 상품 들의 총 가격이 현재 잔액 보다 많을 때 예외를 발생시킨다.\"</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token annotation punctuation\">@Test</span>\r\n    <span class=\"token keyword\">void</span> <span class=\"token function\">deductInSufficientPoint</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// given</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"건희\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">10000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> product1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"양파\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> product2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"당근\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> <span class=\"token class-name\">Order</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product1<span class=\"token punctuation\">,</span> product2<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// when  //then</span>\r\n        <span class=\"token class-name\">Assertions</span><span class=\"token punctuation\">.</span><span class=\"token function\">assertThatThrownBy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span> userManager<span class=\"token punctuation\">.</span><span class=\"token function\">deductPoint</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">,</span>order<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">isInstanceOf</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">InsufficientPointsException</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>테스트는 Mockito 라는 Mocking 프레임워크를 사용하였다.</p>\n<p>Mockito 는 JUnit 에서 가짜 객체인 Mock 을 생성해주고\r\n관리하고 검증할 수 있도록 지원해주는 프레임워크이다.</p>\n<p>유닛 테스트는 스프링 빈을 로드할 필요 없이 테스트를 수행할 모듈과\r\n연결되는 외부의 다른 모듈을 흉내 내는 가짜 모듈을 생성하여 테스트를 진행하면 된다.</p>\n<h4 id=\"test-double\" style=\"position:relative;\"><a href=\"#test-double\" aria-label=\"test double permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Test Double</h4>\n<ul>\n<li>Dummy : 아무 것도 하지 않는 깡통 객체</li>\n<li>Fake : 단순한 형태로 동일한 기능을 수행하나, 프로덕션에서 쓰기에는 부족한 객체</li>\n<li>Stub : 테스트에서 요청한 것에 대해 미리 준비한 결과를 제공하는 객체 그 외에는 응답하지 않는다.</li>\n<li>Spy : Stub 이면서 호출된 내용을 기록하여 보여줄 수 이쓴 객체 일부는 실제 객체처럼 동작시키고 일부만 Stubbing 할 수 있다.</li>\n<li>Mock : 행위에 대한 기대를 명세하고, 그에 따라 동작하도록 만들어진 객체</li>\n</ul>\n<p>관심사를 분리하여 기능 별로 테스트를 하기 쉽게 설계를 변경하여</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5682e46de17abd6052f6962103595f58/249e2/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92.70833333333334%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAACToAAAk6AGCYwUcAAACl0lEQVR42o1Ua3OiMBT1f+xOd1RQfBVE5BkggQBq1W7dutP//yP60bM3qThdp7X9cOYScu/JfZykYzkT2FEIhyVYZgHmkYfxYgZrPsXIvQ3lc8ZJW2fy2jGDAaxohAEb4r5ywR8FJmyK7qKP3tJA1yPrGRrdRU+v9R5Zwzeh4gknMyTrD4jQH8JcDjEMLHiFD7Gr4EkfSxkgbBKwh4xsjKCOkO0ErXOkhHjNMGX3MJaKaHgyA81zJiQYRDplNqImJTBNGK9TxJtUB6t1UMfwq1CTe7QeJ7PPCVuoU+V+Bb8OiSwDI+R7ASefo+v20FuYBNUCsyW7TTjwLX0y30qElEm6zTFLbfSJYEBt0SCfq7gbhBQwiiZwxRJelYNtS9i5Qz0ewQrHet+KxhjHU+2n1jcJ23523V8wIglbFCieShS/JernhrBBfVxDPJYECYe7KvuTJlaEXDZ4D1GtUK232B+OeCQcji+oVg9Ihbz45EX1hrIGV5DNScVxWb92Ip7hGqwUKDcN1k9HPByeIVY1EvrHCoFEcL2vkBS8jTnFIlf2tdNfmriGmuCd8wO9qIBdFGA7RmVLlIeKbKW/012ulXCOOfVJ5FT6x0OZkHTYiiOoIkSkwfvM0RJpBzIMRxffL6esoIKimpGAGU1ZwCZCFayIWu0pn28Tqimrko2kwZyGkG1TiKcaq78blFRyeaipZAG+L75HqDSWrjl8Geo+veltpDO06Ftlpwja0r8U9jieIawS6h+n68dh0JB05v5AvzTG2e9bV085qafqzv4JI67gVjUkCVv+IX0+r7F52SHfcSq7oaGF2vdTQnXqjF6cuMn0E2Zz71Jqe4/HyfS/9c0MlYN6bZKGRLpK4Aj3fVmXCj7o+4XwH3A9XrB+OnV8AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/5682e46de17abd6052f6962103595f58/a59e9/image.webp 192w,\n/static/5682e46de17abd6052f6962103595f58/0ca9f/image.webp 384w,\n/static/5682e46de17abd6052f6962103595f58/dc9b9/image.webp 768w,\n/static/5682e46de17abd6052f6962103595f58/6da5f/image.webp 810w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/5682e46de17abd6052f6962103595f58/3b721/image.png 192w,\n/static/5682e46de17abd6052f6962103595f58/66595/image.png 384w,\n/static/5682e46de17abd6052f6962103595f58/fe486/image.png 768w,\n/static/5682e46de17abd6052f6962103595f58/249e2/image.png 810w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/5682e46de17abd6052f6962103595f58/fe486/image.png\"\n            alt=\"Alt text\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>재고 , 주문 , 포인트 내역 ,잔액 차감 테스트를 진행할 수 있었다.</p>\n<h3 id=\"통합-테스트\" style=\"position:relative;\"><a href=\"#%ED%86%B5%ED%95%A9-%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"통합 테스트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>통합 테스트</h3>\n<ul>\n<li>모듈을 통합하는 과정에서 모듈 간의 호환성을 확인하기 위해 수행되는 테스트</li>\n<li>여러 기능을 조합하여 전체 비즈니스 로직이 제대로 동작하는 지 확인한다.</li>\n<li>=> DB 혹은 외부에서 의존하는 코드, 내 코드의 의존성과 맞물려 있는 코드들이 맞물려 정상적으로 동작하여 하나의 플로우들 제 기능을 하는 지 검증</li>\n<li>@SpringBootTest 를 사용하여 진행</li>\n<li>@SpringBootTest 는 @SpringBootApplication 을 찾아가서 모든 Bean 을 로드하게 된다.</li>\n<li>대규모 프로젝트에서 사용할 경우, 테스트를 실행할 때 마다 모든 빈을 스캔하고 로드하는 작업이 반복되어 매번 무거운 작업을 수행해야 한다.</li>\n</ul>\n<h5 id=\"테스트-코드-1\" style=\"position:relative;\"><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8-%EC%BD%94%EB%93%9C-1\" aria-label=\"테스트 코드 1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>테스트 코드</h5>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">OrderServiceTest</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderService</span> orderService<span class=\"token punctuation\">;</span>\r\n\r\n\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">ProductRepository</span> productRepository<span class=\"token punctuation\">;</span>\r\n\r\n\r\n    <span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"주문 한 상품 수량 만큼 재고를 차감한다.\"</span><span class=\"token punctuation\">)</span>\r\n    <span class=\"token annotation punctuation\">@Test</span>\r\n    <span class=\"token keyword\">void</span> <span class=\"token function\">deductQuantity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\r\n        <span class=\"token comment\">// given</span>\r\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"건희\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000000L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">User</span> savedUser <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token class-name\">Product</span> product1 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"양파\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> product2 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"감자\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">15L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> product3 <span class=\"token operator\">=</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"당금\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3000L</span><span class=\"token punctuation\">,</span> <span class=\"token number\">20L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n        productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">saveAll</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product1<span class=\"token punctuation\">,</span> product2<span class=\"token punctuation\">,</span> product3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n        <span class=\"token class-name\">ProductRequestForOrder</span> request1 <span class=\"token operator\">=</span> <span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product1<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5L</span><span class=\"token punctuation\">,</span>product1<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">ProductRequestForOrder</span> request2 <span class=\"token operator\">=</span> <span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product2<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">8L</span><span class=\"token punctuation\">,</span>product2<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">ProductRequestForOrder</span> request3 <span class=\"token operator\">=</span> <span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product3<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">15L</span><span class=\"token punctuation\">,</span>product3<span class=\"token punctuation\">.</span><span class=\"token function\">getPrice</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ProductRequestForOrder</span><span class=\"token punctuation\">></span></span> requests <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>request1<span class=\"token punctuation\">,</span> request2<span class=\"token punctuation\">,</span> request3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n\r\n        <span class=\"token class-name\">OrderPostRequest</span> orderPostRequest <span class=\"token operator\">=</span> <span class=\"token class-name\">OrderPostRequest</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">userId</span><span class=\"token punctuation\">(</span>savedUser<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">products</span><span class=\"token punctuation\">(</span>requests<span class=\"token punctuation\">)</span>\r\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token comment\">// when</span>\r\n        orderService<span class=\"token punctuation\">.</span><span class=\"token function\">createOrder</span><span class=\"token punctuation\">(</span>orderPostRequest<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n\r\n        <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findAllById</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>product1<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> product2<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> product3<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> findProduct1 <span class=\"token operator\">=</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> findProduct2 <span class=\"token operator\">=</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token class-name\">Product</span> findProduct3 <span class=\"token operator\">=</span> products<span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token comment\">//then</span>\r\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>findProduct1<span class=\"token punctuation\">.</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isZero</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>findProduct2<span class=\"token punctuation\">.</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">7L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>findProduct3<span class=\"token punctuation\">.</span><span class=\"token function\">getQuantity</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span><span class=\"token number\">5L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\r\n    <span class=\"token punctuation\">}</span>\r\n\r\n   <span class=\"token comment\">/// ... ...</span>\r\n\r\n<span class=\"token punctuation\">}</span>\r\n</code></pre></div>\n<p>일반적으로 단위 테스트와 통합 테스트의 정의가 모호해서 사람 마다 분류하는 기준이 다르다고 한다.</p>\n<p>우선 스프링 빈을 로드하거나 h2 같은 테스트 DB를 사용하면 통합 테스트</p>\n<p>그 외에 단일 스레드 ,단일 프로세스 , 디스크 I/O 를 사용하지 않으면 단위 테스트로 분류하였다.</p>\n<p>테스트를 분류하는 기준은 모호하지만, 단위 테스트가 프로젝트에서 가장 많은 비중을 차지 해야하고\r\n개발자가 집중해야 하는 테스트임에는 틀림 없는 것 같다.</p>\n<h3 id=\"느낀점\" style=\"position:relative;\"><a href=\"#%EB%8A%90%EB%82%80%EC%A0%90\" aria-label=\"느낀점 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>느낀점</h3>\n<p>이번에 TDD를 접하고 테스트 코드를 작성 하면서 테스트 코드를 왜 작성해야 하는지\r\n느낄 수 있었다.</p>\n<p>그 동안은 코드가 잘 동작하는 지 확인하기 위해 Postmand 을 사용했었는데\r\n테스트 코드와 비교하면 상당히 수동적이고 불편한 방법이었다.</p>\n<p>내가 작성한 기능 하나를 테스트 하기 위해 api 를 만들고 DB 까지 연결해야 했다.\r\n하지만 유닛 테스트로 api 나 db 연결 할 필요없이 가짜 객체를 통해 내가 만든 기능이 잘 동작하는 지 확인할 수 있었다.</p>\n<p>만약 요구 사항이 변경되어 코드를 수정해야 하는 경우, 테스트 코드를\r\n실행 함으로써 코드 변경이 예상대로 이루어지고 기존 기능에 문제가 없는지\r\n빠르게 확인할 수 있었다.</p>\n<p>수작업으로 진행되던 Postman 방식 보다 훨씬 효율적이다.</p>\n<p>요구 사항이 변경되어 코드를 수정할 때 마다 동작이 잘 안되지 않을까\r\n불안감이 많았는데, 기능이을 추가하거나 수정할 때마다 해당 기능의 동작을 보장하기 위한 테스트 코드를 테스트 코드를 잘 작성하여 실행 하면 앞으로 불안감이 없이 코드를 수정할 수 있을 것 같다.</p>\n<p>그리고 항상 클린 코드와 객체지향적인 코드를 작성하기 위해 고민을 많이 했지만 ,실제로 어떻게 적용해야 할지 몰라 답답함을 느낄 때가 많았다.</p>\n<p>테스트 코드를 작성하다보면 테스트 코드하기 좋은 코드가 뭔지 고민하게 되었고,\r\n이로 인해 클린 코드와 객체지향적인 코드에 대한 원칙들이 실제로 어떻게 구현되어야 하는지에 대한 통찰을 얻을 수 있었습니다.</p>\n<p>테스트 코드를 작성하면서 코드의 모듈화 ,응집도 향상 ,결합도 감소 등에 대해서 고민 하면서 클린 코드와 객체지향적인 설계를 자연스럽게 향상시킬 수 있었습니다.</p>\n<p>앞으로 실무에서도 테스트 코드 작성을 생활화하고 팀원들에게도 전파할 생각입니다.</p>","frontmatter":{"title":"TDD를 위한 시나리오 선정 , 기본 기능 작성 ","summary":"e-커머스 상품 주문 서비스 시나리오를 선정 후 요구사항에 맞는 기능을 TDD로 개발하였습니다.","date":"2023.12.16.","categories":["항해플러스"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAC2klEQVR42pVUbUhTYRQeplAoZFODCn9oBvrDxB/RD4lMSLLAipVhVqBBiVJNKWoL6UOiTMMwhSwLYRAr98NGuLI0/GjN+W0fwrLN4SrRNjenTu/uvU/v3rupCz/qwrnvPfc95znPec7LK8IKD89x1Pz+sSx58cvmiJZHE5Jmh80YlkphSNuPkaIiML/H/fb/DdAbzIyNYSA2DlqRCLrAQLoOpuwBzzDLgi4JyLvddB2trIKOgPSKxeiPjkZPcDA6iG/TNCy0/z+AluJiCtgfE4MvEgl6IyOpP65U+sWtDuit7GhvRwdpVU9AOgMCKLvuiAi4TCYh8K+BrTgU33StNTXoCQ9DV1AQ+ghDm1otBCzR7spTJo+i5SOaDEbAPgGHXg92ahrWlgZMD31dfSg82XSTqgzRxfPtdLmQUfYQz9t03u4ExvbOVliqS8A4HWA5t9dYf0CeJgjVWG/i48YW3K3XzIP5dOWYORjvyTGhe+8nDcdz/gw97F7re3BLUYf6dh0MP0dhIy0KwSxhzVHjCBve6cSkfRzqTiUevSlD13ctIcVTZiKfDIVVT7Am5TDWpR6FKPkQsksqCJCwyS+ShU7f5UDOg3TE5gcj/nwotl/YgNrmigWG2s+DCDt4EjFZuYjKPIPYU3kISTsGVauWBg1Y9LDYTPhlH6H+07f3EZcfgn03EqjtkkUT2wqL1SwA1mqakHTuMk6XVkJy7Q4yi0uRLJWh/IXniLCQvczB7cZClDfJwXAu3FQWYMfFTZArclH0LA/51RnYeWkL9N9aBcBPRjPE6VkIPXAcmyXZCE8/gbV7j+Bddz9l9GPCjBlmCrPuGeqrPtTSdpOuRFF2iYUbkXo9HtbJMY+Ggi7lKjXCSdseDdcTYHmNYok7w3sDMS7IFGeRWBCBBKkYu69uw6uuukXHxhvYN2SEsrkNHYMG4fjwPiDOO5qFgzznnoXe0AZNtwqmUcN8wT/PrYqh2lupCwAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/39350612b57150d8b8584a738ccf163a/7819f/img_1.png","srcSet":"/static/39350612b57150d8b8584a738ccf163a/b061b/img_1.png 111w,\n/static/39350612b57150d8b8584a738ccf163a/c0c13/img_1.png 222w,\n/static/39350612b57150d8b8584a738ccf163a/7819f/img_1.png 443w","sizes":"(min-width: 443px) 443px, 100vw"},"sources":[{"srcSet":"/static/39350612b57150d8b8584a738ccf163a/96e96/img_1.webp 111w,\n/static/39350612b57150d8b8584a738ccf163a/09558/img_1.webp 222w,\n/static/39350612b57150d8b8584a738ccf163a/4805f/img_1.webp 443w","type":"image/webp","sizes":"(min-width: 443px) 443px, 100vw"}]},"width":443,"height":382}},"publicURL":"/static/39350612b57150d8b8584a738ccf163a/img_1.png"}}}}]}},"pageContext":{"slug":"/항해플러스/TDD서버/시나리오선정/"}},"staticQueryHashes":[],"slicesMap":{}}