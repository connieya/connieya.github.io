{"componentChunkName":"component---src-templates-post-template-tsx","path":"/Spring/스프링비즈니스로직/순환참조/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"tableOfContents":"<ul>\n<li>\n<p><a href=\"#%EA%B0%9C%EC%9A%94\">개요</a></p>\n<ul>\n<li><a href=\"#%EB%AC%B8%EC%A0%9C\">문제</a></li>\n<li><a href=\"#%ED%95%B4%EA%B2%B0\">해결</a></li>\n</ul>\n</li>\n</ul>","html":"<h2 id=\"개요\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EC%9A%94\" aria-label=\"개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개요</h2>\n<p>서비스 개발 중에 스프링 객체간 의존성 주입을 한 뒤 애플리케이션 로딩 과정에서\r\n스프링 컨테이너가 예외를 발생시킴</p>\n<p><strong>코드</strong></p>\n<p>예)</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskService</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PlanService</span> planService<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">/// ... 기타 메서드</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>스케줄러와 관련된 비즈니스 로직에서 계획과 관련된 비즈니스 로직을 사용하기 위해 <strong><em>생성자를 통해 의존성 주입</em></strong>\r\n을 하였다.</p>\n<p>따로 코드를 작성하기 보다는 해당 로직을 재사용하기 위한 목적으로 다른 서비스 로직을 의존성 주입을 한것인데 문제가 발생하였다.</p>\n<h3 id=\"문제\" style=\"position:relative;\"><a href=\"#%EB%AC%B8%EC%A0%9C\" aria-label=\"문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>문제</h3>\n<p><strong>순환 의존성 문제가 발생 할 수 있음</strong></p>\n<p>순환 의존성이란 ?</p>\n<blockquote>\n<p>A 서비스가 B 서비스를 주입하고 B 서비스가 A 서비스를 다시 주입하는 경우 순환 의존성이 발생한다.\r\n이는 런타임 에러를 일으킬 수 있으므로 주의가 필요하다.</p>\n</blockquote>\n<p>위의 코드에서는 TaskService => PlanService 만 주입하기 때문에\r\n문제가 발생하지 않았지만\r\n만약에 여기서 PlanService => TaskService 도 주입한다면??</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">PlanService</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">TaskService</span> taskService<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 기타 메서드</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>애플리케이션을 실행 했을 때 스프링 컨테이너가 예외를 발생시킨다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8cf388a2492a2b52ad09d43f0abf44cd/5e281/img.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 4.6875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAANUlEQVR42jWKQQoAMAjD9iMHWuv/P+ZU5iEU0hwAaWbZS3J2XeOOwsdFMFWr/V+7/ra9IvkABvcgRbLzBikAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8cf388a2492a2b52ad09d43f0abf44cd/a59e9/img.webp 192w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/0ca9f/img.webp 384w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/dc9b9/img.webp 768w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/e2c2f/img.webp 1152w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/e6692/img.webp 1407w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8cf388a2492a2b52ad09d43f0abf44cd/3b721/img.png 192w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/66595/img.png 384w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/fe486/img.png 768w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/d2d74/img.png 1152w,\n/static/8cf388a2492a2b52ad09d43f0abf44cd/5e281/img.png 1407w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8cf388a2492a2b52ad09d43f0abf44cd/fe486/img.png\"\n            alt=\"img.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ceeeafdfd3c3f052076ce225498a2f5a/b59ab/img_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 23.958333333333336%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVR42q2PTQ4CIQyFuQ4FJlAK49KY6Kj3v099HYUYM0sXH/17LXkuhKD/xHnv9Rf6wmoTHs0C0dQMXGtNezf6jqCuiAaLqEjVlJIyswp6BT2GJte6U5Gv6+m9i5mzx45OUF8hfOLAGTDymKL2UvSBfEO8o3/LWTdwQc+O2a597o7sRrB84rBs9hLywUIGTc2w/AKZJpn97rPsRQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/ceeeafdfd3c3f052076ce225498a2f5a/a59e9/img_1.webp 192w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/0ca9f/img_1.webp 384w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/dc9b9/img_1.webp 768w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/426c3/img_1.webp 922w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/ceeeafdfd3c3f052076ce225498a2f5a/3b721/img_1.png 192w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/66595/img_1.png 384w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/fe486/img_1.png 768w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/b59ab/img_1.png 922w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/ceeeafdfd3c3f052076ce225498a2f5a/fe486/img_1.png\"\n            alt=\"img_1.png\"\n            title=\"\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>그림과 같이 PlanService 클래스와 TaskService 클래스 빈들이\r\n서로 참조를 하여 맞물리게 된다.</p>\n<p>즉, 스프링에서 어떤 스프링 빈을 먼저 만들어야 할 지 결정할 수 없게 되는 상황이다.</p>\n<p>위의 코드 방식은 생성자 주입을 통해 의존성을 주입 하였다.</p>\n<p>만약 @Autowired 를 통한 필드 주입 방식을 한다면?</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskService</span> <span class=\"token punctuation\">{</span>\r\n\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PlanService</span> planService<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">/// ... 기타 메서드</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\r\n\r\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">TaskService</span> <span class=\"token punctuation\">{</span>\r\n    <span class=\"token annotation punctuation\">@Autowired</span>\r\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">PlanService</span> planService<span class=\"token punctuation\">;</span>\r\n\r\n    <span class=\"token comment\">// 기타 메서드..</span>\r\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>스프링 컨테이너가 로딩 당시 예외를 발생시키지 않는다.</p>\n<p>그러면 순환 참조 문제가 발생하지 않는걸까?</p>\n<p>@Autowired 필드 주입 방식과 Setter 방식은 애플리케이션 구동 시점에서는\r\n필요한 의존성이 없을 경우 null 상태로 유지하고 실제로 사용하는 시점에\r\n주입을 하기 때문에 예외가 발생하지 않지만\r\n순환 참조를 일으킬 수 있는 메서드를 호출하는 시점에는 순환참조 문제가 발생할 수 있다.</p>\n<h3 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결</h3>\n<p>스케줄러 관련 서비스에서는 계획과 관련된 단순 DB 조회만 필요하기 때문에</p>\n<p>Repository 의존성 주입으로 해결하였다.</p>","frontmatter":{"title":"Dependency Injection 시 순환 참조 문제","summary":"Dependecy Injection 시 순환 참조가 발생할 수 있는 코드","date":"2023.09.20.","categories":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVR42q2PzQ4CIQyEeR3+NlBKd4/GRFd9//ep040QD+vNw5eZloEwLsao/8R57/WM8IXNFj47iyHMjOFERHvvKmLIAWNuUIOYlblpzlmJSBm7ih0hU1o7aPDruh13nT3GCJhOMN8QfOGBCyD4lJNKrfqE36EP7O+l6A6u2I2PuV91E1g+OipbvQw/WIIRZsYqvwGeK5oHgZMyoAAAAABJRU5ErkJggg=="},"images":{"fallback":{"src":"/static/ceeeafdfd3c3f052076ce225498a2f5a/3d2ab/img_1.png","srcSet":"/static/ceeeafdfd3c3f052076ce225498a2f5a/61769/img_1.png 231w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/869c3/img_1.png 461w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/3d2ab/img_1.png 922w","sizes":"(min-width: 922px) 922px, 100vw"},"sources":[{"srcSet":"/static/ceeeafdfd3c3f052076ce225498a2f5a/86803/img_1.webp 231w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/71d54/img_1.webp 461w,\n/static/ceeeafdfd3c3f052076ce225498a2f5a/316bb/img_1.webp 922w","type":"image/webp","sizes":"(min-width: 922px) 922px, 100vw"}]},"width":922,"height":223}},"publicURL":"/static/ceeeafdfd3c3f052076ce225498a2f5a/img_1.png"}}}}]}},"pageContext":{"slug":"/Spring/스프링비즈니스로직/순환참조/"}},"staticQueryHashes":[],"slicesMap":{}}